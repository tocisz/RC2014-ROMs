# This is a basic workflow to help you get started with Actions

name: Build ROMs

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Fetch NASCOM-BASIC release
        id: fetch_nascom
        run: |
          RELEASE_DATA=$(curl -s https://api.github.com/repos/tocisz/RC2014-NASCOM/releases/latest)
          RELEASE_ID=$(echo "$RELEASE_DATA" | jq -r '.id')
          echo "Latest release ID: $RELEASE_ID"
          echo "$RELEASE_DATA" > nascom-release.json
          ASSETS=$(jq -c '.assets[]' nascom-release.json)    
          mkdir -p nascom
          for ASSET in $ASSETS; do
            ASSET_URL=$(echo "$ASSET" | jq -r '.url')
            ASSET_NAME=$(echo "$ASSET" | jq -r '.name')
            echo "Downloading asset: $ASSET_NAME from $ASSET_URL"
            curl -L -H "Accept: application/octet-stream" "$ASSET_URL" -o "nascom/$ASSET_NAME"
          done

      - name: Fetch TC2014-FORTH release
        id: fetch_forth
        run: |
          RELEASE_DATA=$(curl -s https://api.github.com/repos/tocisz/TC2014-FORTH/releases/latest)
          RELEASE_ID=$(echo "$RELEASE_DATA" | jq -r '.id')
          echo "Latest release ID: $RELEASE_ID"
          echo "$RELEASE_DATA" > forth-release.json
          ASSETS=$(jq -c '.assets[]' forth-release.json)    
          mkdir -p forth
          for ASSET in $ASSETS; do
            ASSET_URL=$(echo "$ASSET" | jq -r '.url')
            ASSET_NAME=$(echo "$ASSET" | jq -r '.name')
            echo "Downloading asset: $ASSET_NAME from $ASSET_URL"
            curl -L -H "Accept: application/octet-stream" "$ASSET_URL" -o "forth/$ASSET_NAME"
          done

      - name: List Downloaded Files
        run: ls -lR .
